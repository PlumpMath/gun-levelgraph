{"version":3,"sources":["save-levelgraph.js"],"names":["createSaveToLvGraph","saveToLvGraph","$saveToLvGraph","addSaveToLvGraph","levelup","require","levelgraph","jsonld","defaultOpts","dbPath","base","logger","opts","log","logging","args","buildOpts","Object","assign","levelDB","lvGraphDb","db","_opts","dbOptions","cb","Error","put","dbGet","get","$dbGet","queryId","queryOpts","chain"],"mappings":"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","file":"save-levelgraph.js","sourcesContent":["const levelup = require('levelup')\nconst levelgraph = require('levelgraph')\nconst jsonld = require('levelgraph-jsonld')\n\nimport {\n  promisify,\n  promisifyWithOpts\n} from './promisify'\n\nconst defaultOpts = {\n  dbPath: './gundb',\n  base: 'http://gun.io/base'\n}\n\nconst logger = (opts = {}) => {\n  return function log(...args) {\n    if (opts.logging) {\n      console.log('toLdGraph:', ...args)\n    }\n  }\n}\n\nfunction buildOpts(opts) {\n  opts = Object.assign(defaultOpts, opts)\n\n  opts.levelDB = opts.levelDB || levelup(opts.dbPath)\n  opts.lvGraphDb = opts.lvGraphDb || levelgraph(opts.levelDB)\n  opts.db = opts.db || jsonld(opts.lvGraphDb, opts)\n  opts.logger = opts.logger || logger\n  opts.log = opts.log || opts.logger(opts)\n\n  return opts\n}\n\nexport function createSaveToLvGraph(_opts) {\n  let dbOptions = buildOpts(_opts)\n\n  const saveToLvGraph = function (jsonld, cb, opts) {\n    opts = Object.assign(dbOptions, opts)\n    const db = opts.db\n    if (!db) {\n      throw new Error('saveToLvGraph: missing db option')\n    }\n    opts.log('put', db.jsonld, jsonld)\n    db.jsonld.put(jsonld, cb, opts)\n  }\n\n  const $saveToLvGraph = function (jsonld, opts) {\n    opts = Object.assign(dbOptions, opts)\n    return promisify(saveToLvGraph, jsonld, opts)\n  }\n\n  const dbGet = dbOptions.db.jsonld.get\n\n  const $dbGet = function (queryId, queryOpts) {\n    return promisifyWithOpts(dbGet, queryId, queryOpts)\n  }\n\n  return {\n    dbGet,\n    $dbGet,\n    dbOptions,\n    saveToLvGraph,\n    $saveToLvGraph\n  }\n}\n\nexport function saveToLvGraph(jsonld, cb, opts) {\n  opts = Object.assign(defaultOpts, opts)\n  opts = buildOpts(opts)\n\n  const db = opts.db\n  if (!db) {\n    throw new Error('saveToLvGraph: missing db option')\n  }\n  db.jsonld.put(jsonld, cb, opts)\n}\n\nexport function $saveToLvGraph(jsonld, cb, opts) {\n  return promisify(saveToLvGraph, jsonld, opts)\n}\n\nexport function addSaveToLvGraph(chain) {\n  chain.saveToLvGraph = function (cb, opts) {\n    return saveToLvGraph(this, cb, opts)\n  }\n\n  chain.$saveToLvGraph = function (cb, opts) {\n    return $saveToLvGraph(this, cb, opts)\n  }\n\n  return chain\n}\n\nexport default addSaveToLvGraph"]}